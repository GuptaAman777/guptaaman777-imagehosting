<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuptaAman777 Image Gallery</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #5865F2;
            --secondary-color: #3BA55C;
            --background-color: #36393F;
            --sidebar-color: #2F3136;
            --channel-color: #42464D;
            --text-color: #DCDDDE;
            --text-muted: #96989D;
            --header-color: #202225;
            --card-shadow: 0 2px 10px rgba(0,0,0,0.2);
            --hover-bg: rgba(79, 84, 92, 0.3);
            --active-bg: rgba(79, 84, 92, 0.6);
            --divider-color: #42464D;
            --status-online: #3BA55C;
            --status-idle: #FAA61A;
            --status-dnd: #ED4245;
            --status-offline: #747F8D;
            --scrollbar-thumb: #202225;
            --scrollbar-track: #2E3338;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        body {
            line-height: 1.6;
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar styles */
        .sidebar {
            width: 72px;
            background-color: var(--sidebar-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 0;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .server-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            cursor: pointer;
            transition: border-radius 0.2s;
            color: white;
            font-size: 20px;
        }

        .server-icon:hover {
            border-radius: 16px;
            background-color: var(--primary-color);
        }

        .server-icon.active {
            border-radius: 16px;
        }

        .server-divider {
            height: 2px;
            width: 32px;
            background-color: var(--divider-color);
            margin: 8px 0;
        }

        /* Channel sidebar styles */
        .channels-sidebar {
            width: 240px;
            background-color: var(--channel-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .server-header {
            padding: 16px;
            font-weight: bold;
            font-size: 16px;
            border-bottom: 1px solid var(--divider-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .server-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .channel-category {
            padding: 16px 8px 4px 16px;
            text-transform: uppercase;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .channel-category i {
            font-size: 10px;
            cursor: pointer;
        }

        .channel {
            padding: 6px 8px 6px 20px;
            margin: 1px 8px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 14px;
        }

        .channel:hover {
            background-color: var(--hover-bg);
            color: var(--text-color);
        }

        .channel.active {
            background-color: var(--active-bg);
            color: var(--text-color);
        }

        .channel i {
            margin-right: 6px;
            font-size: 16px;
        }

        .channel-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Main content area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--divider-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-channel-info {
            display: flex;
            align-items: center;
        }

        .header-channel-info i {
            margin-right: 6px;
            font-size: 18px;
            color: var(--text-muted);
        }

        .header-channel-name {
            font-weight: 600;
            font-size: 16px;
        }

        .header-actions {
            display: flex;
            gap: 16px;
        }

        .header-action {
            color: var(--text-muted);
            cursor: pointer;
            font-size: 18px;
        }

        .header-action:hover {
            color: var(--text-color);
        }

        .search-container {
            position: relative;
            width: 240px;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px 8px 32px;
            background-color: var(--header-color);
            border: none;
            border-radius: 4px;
            color: var(--text-color);
            font-size: 14px;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-input:focus {
            outline: none;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Gallery content */
        .gallery-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
            align-content: start;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Image card styles */
        .image-card {
            background-color: var(--channel-color);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
            box-shadow: var(--card-shadow);
        }

        .image-card:hover {
            transform: translateY(-4px);
        }

        .image-container {
            position: relative;
            padding-top: 56.25%; /* 16:9 aspect ratio */
            overflow: hidden;
        }

        .image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .image-card:hover .image-container img {
            transform: scale(1.05);
        }

        .image-info {
            padding: 12px;
        }

        .image-name {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .image-meta {
            color: var(--text-muted);
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }

        .image-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .image-btn {
            background-color: var(--background-color);
            color: var(--text-color);
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background-color 0.2s;
        }

        .image-btn:hover {
            background-color: var(--primary-color);
        }

        /* Loading indicator */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            color: var(--text-muted);
            gap: 16px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* No results message */
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--background-color);
        }

        .modal-header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--divider-color);
        }

        .modal-title {
            font-weight: 600;
            font-size: 16px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
        }

        .close-modal:hover {
            color: var(--text-color);
        }

        .modal-image-container {
            position: relative;
            height: 70vh;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .nav-buttons {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            pointer-events: none;
        }

        .nav-button {
            width: 40px;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            pointer-events: auto;
            transition: background-color 0.2s;
        }

        .nav-button:hover {
            background-color: var(--primary-color);
        }

        .modal-footer {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--divider-color);
        }

        .modal-info {
            color: var(--text-muted);
            font-size: 14px;
        }

        .modal-actions {
            display: flex;
            gap: 8px;
        }

        .modal-btn {
            background-color: var(--channel-color);
            color: var(--text-color);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background-color 0.2s;
        }

        .modal-btn:hover {
            background-color: var(--hover-bg);
        }

        .modal-btn-primary {
            background-color: var(--primary-color);
        }

        .modal-btn-primary:hover {
            background-color: #4752c4;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
            box-shadow: var(--card-shadow);
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background-color: var(--header-color);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
            z-index: 100;
            box-shadow: var(--card-shadow);
        }

        /* Filter tags */
        .filter-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .filter-tag {
            background-color: var(--channel-color);
            color: var(--text-muted);
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tag:hover {
            background-color: var(--hover-bg);
            color: var(--text-color);
        }

        .filter-tag.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                padding: 0 16px;
                overflow-x: auto;
            }

            .server-icon {
                margin: 0 4px;
            }

            .server-divider {
                width: 2px;
                height: 32px;
                margin: 0 8px;
            }

            .channels-sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                overflow-x: auto;
                padding: 0 16px;
            }

            .server-header {
                display: none;
            }

            .channel-category {
                display: none;
            }

            .channel {
                padding: 8px 12px;
                margin: 0 4px;
                white-space: nowrap;
            }

            .content-area {
                height: calc(100vh - 120px);
            }

            .gallery-content {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .search-container {
                width: 160px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Server sidebar -->
        <div class="sidebar">
            <div class="server-icon active">
                <i class="fas fa-image"></i>
            </div>
            <div class="server-divider"></div>
            <!-- Additional server icons would go here in a real Discord-like app -->
            <div class="server-icon">
                <i class="fas fa-folder"></i>
            </div>
            <div class="server-icon">
                <i class="fas fa-star"></i>
            </div>
        </div>

        <!-- Channels sidebar -->
        <div class="channels-sidebar">
            <div class="server-header">
                <div class="server-name">GuptaAman777 Gallery</div>
                <i class="fas fa-chevron-down"></i>
            </div>
            
            <div class="channel-category">
                <span>Image Collections</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            
            <div id="folderChannels">
                <!-- Folder channels will be dynamically added here -->
                <div class="channel active">
                    <i class="fas fa-hashtag"></i>
                    <span class="channel-name">all-images</span>
                </div>
            </div>
            
            <div class="channel-category">
                <span>Filters</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            
            <div id="filterChannels">
                <!-- Filter channels will be dynamically added here -->
            </div>
        </div>

        <!-- Main content area -->
        <div class="content-area">
            <div class="content-header">
                <div class="header-channel-info">
                    <i class="fas fa-hashtag"></i>
                    <span class="header-channel-name" id="currentChannel">all-images</span>
                </div>
                
                <div class="header-actions">
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search images..." id="searchInput">
                    </div>
                    <div class="header-action" id="refreshBtn" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <div class="header-action" id="expandAllBtn" title="Expand All">
                        <i class="fas fa-expand-alt"></i>
                    </div>
                </div>
            </div>
            
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <span>Loading images from GitHub repository...</span>
            </div>
            
            <div id="noResults" class="no-results" style="display:none;">
                <i class="fas fa-search" style="font-size: 2em; margin-bottom: 15px;"></i>
                <p>No images found matching your search criteria.</p>
            </div>
            
            <div class="gallery-content" id="galleryContent" style="display:none;">
                <div class="filter-tags" id="filterTags">
                    <!-- Filter tags will be dynamically added here -->
                </div>
                
                <div id="imageGrid" style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px;">
                    <!-- Images will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Image Viewer</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-image-container">
                <img id="modalImage" src="" alt="Full Image">
                <div class="nav-buttons">
                    <button class="nav-button" id="prevImageBtn"><i class="fas fa-chevron-left"></i></button>
                    <button class="nav-button" id="nextImageBtn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-info" id="modalInfo">Image details</div>
                <div class="modal-actions">
                    <button class="modal-btn" id="copyUrlBtn"><i class="fas fa-link"></i> Copy URL</button>
                    <button class="modal-btn modal-btn-primary" id="downloadBtn"><i class="fas fa-download"></i> Download</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tooltip" class="tooltip"></div>
    <div id="toast" class="toast">URL copied to clipboard!</div>

    <script>
        // Configuration
        const GITHUB_USERNAME = 'GuptaAman777';
        const GITHUB_REPO = 'guptaaman777-imagehosting';
        const BRANCH = 'main';
        
        // Global state
        let allImages = [];
        let currentImages = [];
        let currentImageIndex = 0;
        let activeFilters = new Set();
        let currentToastTimeout = null;
        let currentFolder = 'all';

        // Fetch repository contents recursively
        async function fetchAllRepositoryContents(path = '') {
            const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${path}`;
            
            try {
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const contents = await response.json();
                let allImages = [];

                for (const item of contents) {
                    if (item.type === 'dir') {
                        const subImages = await fetchAllRepositoryContents(item.path);
                        allImages = allImages.concat(subImages);
                    } else if (isImageFile(item.name)) {
                        allImages.push(item);
                    }
                }

                return allImages;
            } catch (error) {
                console.error('Fetch error:', error);
                return [];
            }
        }

        // Check if file is an image
        function isImageFile(filename) {
            const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg'];
            return imageExtensions.includes(filename.split('.').pop().toLowerCase());
        }

        // Create raw GitHub URL for image - properly encoding the path
        function createRawUrl(path) {
            // Split the path into segments and encode each segment individually
            const pathSegments = path.split('/');
            const encodedPath = pathSegments.map(segment => encodeURIComponent(segment)).join('/');
            return `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/${BRANCH}/${encodedPath}`;
        }

        // Organize images into folder structure
        function organizeImagesByFolders(images) {
            const folderStructure = {
                'all': { name: 'All Images', images: [...images] }
            };

            images.forEach(image => {
                const pathParts = image.path.split('/');
                
                // Determine the folder path (everything except the filename)
                if (pathParts.length > 1) {
                    const folderPath = pathParts[0]; // Just use the first level folder
                    
                    // Ensure folder exists in structure
                    if (!folderStructure[folderPath]) {
                        folderStructure[folderPath] = { 
                            name: folderPath.charAt(0).toUpperCase() + folderPath.slice(1), 
                            images: [] 
                        };
                    }
                    
                    // Add image to folder
                    folderStructure[folderPath].images.push(image);
                } else {
                    // For root images, create a "Root" folder if it doesn't exist
                    if (!folderStructure['root']) {
                        folderStructure['root'] = { name: 'Root', images: [] };
                    }
                    folderStructure['root'].images.push(image);
                }
            });

            return folderStructure;
        }

        // Get unique file extensions from images
        function getUniqueExtensions(images) {
            const extensions = new Set();
            images.forEach(image => {
                const extension = image.name.split('.').pop().toLowerCase();
                extensions.add(extension);
            });
            return Array.from(extensions);
        }

        // Initialize folder channels
        function initializeFolderChannels(folderStructure) {
            const folderChannels = document.getElementById('folderChannels');
            folderChannels.innerHTML = '';
            
            // Add "all-images" channel
            const allChannel = document.createElement('div');
            allChannel.className = 'channel active';
            allChannel.setAttribute('data-folder', 'all');
            allChannel.innerHTML = `
                <i class="fas fa-hashtag"></i>
                <span class="channel-name">all-images</span>
            `;
            folderChannels.appendChild(allChannel);
            
            // Add other folder channels
            Object.entries(folderStructure).forEach(([key, folder]) => {
                if (key !== 'all') {
                    const channelElement = document.createElement('div');
                    channelElement.className = 'channel';
                    channelElement.setAttribute('data-folder', key);
                    channelElement.innerHTML = `
                        <i class="fas fa-hashtag"></i>
                        <span class="channel-name">${folder.name.toLowerCase()}</span>
                    `;
                    folderChannels.appendChild(channelElement);
                }
            });
            
            // Add event listeners to channels
            document.querySelectorAll('.channel').forEach(channel => {
                channel.addEventListener('click', () => {
                    // Remove active class from all channels
                    document.querySelectorAll('.channel').forEach(ch => {
                        ch.classList.remove('active');
                    });
                    
                    // Add active class to clicked channel
                    channel.classList.add('active');
                    
                    // Update current folder and display images
                    const folder = channel.getAttribute('data-folder');
                    currentFolder = folder;
                    
                    // Update header
                    document.getElementById('currentChannel').textContent = channel.querySelector('.channel-name').textContent;
                    
                    // Display images for this folder
                    displayImagesForFolder(folder);
                });
            });
        }

        // Initialize filter tags
        function initializeFilterTags(extensions) {
            const filterTags = document.getElementById('filterTags');
            filterTags.innerHTML = '<div class="filter-tag active" data-extension="all">All</div>';
            
            extensions.forEach(ext => {
                const filterTag = document.createElement('div');
                filterTag.className = 'filter-tag';
                filterTag.setAttribute('data-extension', ext);
                filterTag.textContent = ext.toUpperCase();
                filterTags.appendChild(filterTag);
            });
            
            // Add event listeners to filter tags
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const extension = tag.getAttribute('data-extension');
                    
                    if (extension === 'all') {
                        // Deactivate all other filters
                        document.querySelectorAll('.filter-tag').forEach(t => {
                            t.classList.remove('active');
                        });
                        tag.classList.add('active');
                        activeFilters.clear();
                    } else {
                        // Remove "all" filter if it's active
                        document.querySelector('.filter-tag[data-extension="all"]').classList.remove('active');
                        
                        // Toggle this filter
                        tag.classList.toggle('active');
                        
                        if (tag.classList.contains('active')) {
                            activeFilters.add(extension);
                        } else {
                            activeFilters.delete(extension);
                        }
                        
                        // If no filters are active, activate "all"
                        if (activeFilters.size === 0) {
                            document.querySelector('.filter-tag[data-extension="all"]').classList.add('active');
                        }
                    }
                    
                    applyFilters();
                });
            });
            
            // Also initialize filter channels
            const filterChannels = document.getElementById('filterChannels');
            filterChannels.innerHTML = '';
            
            extensions.forEach(ext => {
                const channelElement = document.createElement('div');
                channelElement.className = 'channel';
                channelElement.setAttribute('data-extension', ext);
                channelElement.innerHTML = `
                    <i class="fas fa-circle" style="font-size: 10px;"></i>
                    <span class="channel-name">${ext.toUpperCase()}</span>
                `;
                filterChannels.appendChild(channelElement);
            });
            
            // Add event listeners to filter channels
            document.querySelectorAll('#filterChannels .channel').forEach(channel => {
                channel.addEventListener('click', () => {
                    const extension = channel.getAttribute('data-extension');
                    
                    // Toggle active state
                    channel.classList.toggle('active');
                    
                    // Update filter tags to match
                    const correspondingTag = document.querySelector(`.filter-tag[data-extension="${extension}"]`);
                    if (correspondingTag) {
                        correspondingTag.classList.toggle('active');
                    }
                    
                    // Update active filters
                    if (channel.classList.contains('active')) {
                        activeFilters.add(extension);
                        // Remove "all" filter if it's active
                        document.querySelector('.filter-tag[data-extension="all"]').classList.remove('active');
                    } else {
                        activeFilters.delete(extension);
                        // If no filters are active, activate "all"
                        if (activeFilters.size === 0) {
                            document.querySelector('.filter-tag[data-extension="all"]').classList.add('active');
                        }
                    }
                    
                    applyFilters();
                });
            });
        }

        // Apply filters to current images
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // Filter images based on active filters and search term
            let filteredImages = [];
            
            if (activeFilters.size === 0) {
                // If no filters are active, show all images in current folder
                filteredImages = [...currentImages];
            } else {
                // Filter by extension
                filteredImages = currentImages.filter(image => {
                    const extension = image.name.split('.').pop().toLowerCase();
                    return activeFilters.has(extension);
                });
            }
            
            // Apply search filter
            if (searchTerm) {
                filteredImages = filteredImages.filter(image => 
                    image.name.toLowerCase().includes(searchTerm)
                );
            }
            
            // Display filtered images
            renderImages(filteredImages);
        }

        // Display images for a specific folder
        function displayImagesForFolder(folder) {
            const folderStructure = organizeImagesByFolders(allImages);
            
            if (folderStructure[folder]) {
                currentImages = folderStructure[folder].images;
                applyFilters();
            }
        }

        // Render images to the grid
        function renderImages(images) {
            const imageGrid = document.getElementById('imageGrid');
            const noResults = document.getElementById('noResults');
            
            if (images.length === 0) {
                imageGrid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            imageGrid.style.display = 'grid';
            noResults.style.display = 'none';
            
            // Clear existing images
            imageGrid.innerHTML = '';
            
            // Add images to grid
            images.forEach((image, index) => {
                const imageCard = document.createElement('div');
                imageCard.className = 'image-card';
                
                const rawUrl = createRawUrl(image.path);
                const extension = image.name.split('.').pop().toLowerCase();
                const fileSize = formatFileSize(image.size);
                
                imageCard.innerHTML = `
                    <div class="image-container">
                        <img src="${rawUrl}" alt="${image.name}" loading="lazy">
                    </div>
                    <div class="image-info">
                        <div class="image-name">${image.name}</div>
                        <div class="image-meta">
                            <span>${extension.toUpperCase()}</span>
                            <span>${fileSize}</span>
                        </div>
                        <div class="image-actions">
                            <button class="image-btn view-btn" data-index="${index}">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="image-btn download-btn" data-url="${rawUrl}" data-name="${image.name}">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    </div>
                `;
                
                imageGrid.appendChild(imageCard);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.getAttribute('data-index'));
                    openImageModal(images, index);
                });
            });
            
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const url = btn.getAttribute('data-url');
                    const name = btn.getAttribute('data-name');
                    downloadImage(url, name);
                });
            });
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // Open image modal
        function openImageModal(images, index) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const modalInfo = document.getElementById('modalInfo');
            
            currentImages = images;
            currentImageIndex = index;
            
            const image = images[index];
            const rawUrl = createRawUrl(image.path);
            
            modalImage.src = rawUrl;
            modalTitle.textContent = image.name;
            
            const extension = image.name.split('.').pop().toUpperCase();
            const fileSize = formatFileSize(image.size);
            modalInfo.textContent = `${extension} • ${fileSize}`;
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Fade in animation
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }

        // Close image modal
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }, 300);
        }

        // Navigate to previous image
        function navigateToPrevImage() {
            if (currentImages.length === 0) return;
            
            currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
            updateModalImage();
        }

        // Navigate to next image
        function navigateToNextImage() {
            if (currentImages.length === 0) return;
            
            currentImageIndex = (currentImageIndex + 1) % currentImages.length;
            updateModalImage();
        }

        // Update modal image
        function updateModalImage() {
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const modalInfo = document.getElementById('modalInfo');
            
            const image = currentImages[currentImageIndex];
            const rawUrl = createRawUrl(image.path);
            
            // Add fade out/in effect
            modalImage.style.opacity = '0';
            
            setTimeout(() => {
                modalImage.src = rawUrl;
                modalTitle.textContent = image.name;
                
                const extension = image.name.split('.').pop().toUpperCase();
                const fileSize = formatFileSize(image.size);
                modalInfo.textContent = `${extension} • ${fileSize}`;
                
                modalImage.style.opacity = '1';
            }, 200);
        }

        // Copy image URL to clipboard
        function copyImageUrl() {
            if (currentImages.length === 0 || currentImageIndex < 0) return;
            
            const image = currentImages[currentImageIndex];
            const rawUrl = createRawUrl(image.path);
            
            navigator.clipboard.writeText(rawUrl).then(() => {
                showToast('URL copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy URL: ', err);
                showToast('Failed to copy URL', true);
            });
        }

        // Download image
        function downloadImage(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.target = '_blank';
            a.click();
        }

        // Show toast notification
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            
            // Clear any existing timeout
            if (currentToastTimeout) {
                clearTimeout(currentToastTimeout);
            }
            
            // Set message and show toast
            toast.textContent = message;
            toast.className = isError ? 'toast error show' : 'toast show';
            
            // Hide toast after 3 seconds
            currentToastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize tooltip functionality
        function initializeTooltips() {
            const tooltip = document.getElementById('tooltip');
            
            document.querySelectorAll('[title]').forEach(element => {
                element.addEventListener('mouseenter', (e) => {
                    const title = e.target.getAttribute('title');
                    if (!title) return;
                    
                    // Remove the title attribute to prevent default tooltip
                    e.target.setAttribute('data-title', title);
                    e.target.removeAttribute('title');
                    
                    // Position and show tooltip
                    const rect = e.target.getBoundingClientRect();
                    tooltip.textContent = title;
                    tooltip.style.top = (rect.top - tooltip.offsetHeight - 10) + 'px';
                    tooltip.style.left = (rect.left + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
                    tooltip.style.opacity = '1';
                });
                
                element.addEventListener('mouseleave', (e) => {
                    // Restore title attribute
                    const dataTitle = e.target.getAttribute('data-title');
                    if (dataTitle) {
                        e.target.setAttribute('title', dataTitle);
                        e.target.removeAttribute('data-title');
                    }
                    
                    // Hide tooltip
                    tooltip.style.opacity = '0';
                });
            });
        }

        // Initialize the application
        async function initializeApp() {
            // Show loading indicator
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('galleryContent').style.display = 'none';
            
            try {
                // Fetch all images from repository
                allImages = await fetchAllRepositoryContents();
                
                if (allImages.length === 0) {
                    document.getElementById('loading').innerHTML = `
                        <i class="fas fa-exclamation-circle" style="font-size: 2em; margin-bottom: 15px;"></i>
                        <p>No images found in the repository. Please check your repository settings.</p>
                    `;
                    return;
                }
                
                // Organize images by folders
                const folderStructure = organizeImagesByFolders(allImages);
                
                // Get unique file extensions
                const extensions = getUniqueExtensions(allImages);
                
                // Initialize UI components
                initializeFolderChannels(folderStructure);
                initializeFilterTags(extensions);
                initializeTooltips();
                
                // Set initial images (all images)
                currentImages = folderStructure['all'].images;
                renderImages(currentImages);
                
                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('galleryContent').style.display = 'grid';
                
                // Add event listeners
                document.getElementById('searchInput').addEventListener('input', () => {
                    applyFilters();
                });
                
                document.getElementById('refreshBtn').addEventListener('click', (e) => {
                    e.target.classList.add('rotating');
                    initializeApp().then(() => {
                        e.target.classList.remove('rotating');
                        showToast('Gallery refreshed!');
                    });
                });
                
                document.querySelector('.close-modal').addEventListener('click', closeImageModal);
                
                document.getElementById('prevImageBtn').addEventListener('click', navigateToPrevImage);
                document.getElementById('nextImageBtn').addEventListener('click', navigateToNextImage);
                
                document.getElementById('copyUrlBtn').addEventListener('click', copyImageUrl);
                
                document.getElementById('downloadBtn').addEventListener('click', () => {
                    if (currentImages.length === 0 || currentImageIndex < 0) return;
                    
                    const image = currentImages[currentImageIndex];
                    const rawUrl = createRawUrl(image.path);
                    downloadImage(rawUrl, image.name);
                });
                
                // Close modal when clicking outside content
                document.getElementById('imageModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('imageModal')) {
                        closeImageModal();
                    }
                });
                
                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (document.getElementById('imageModal').style.display === 'flex') {
                        if (e.key === 'Escape') {
                            closeImageModal();
                        } else if (e.key === 'ArrowLeft') {
                            navigateToPrevImage();
                        } else if (e.key === 'ArrowRight') {
                            navigateToNextImage();
                        }
                    }
                });
                
            } catch (error) {
                console.error('Error initializing app:', error);
                document.getElementById('loading').innerHTML = `
                    <i class="fas fa-exclamation-circle" style="font-size: 2em; margin-bottom: 15px;"></i>
                    <p>Error loading images: ${error.message}</p>
                `;
            }
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>                    